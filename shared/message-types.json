{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "Oko WebSocket message types - shared between backend and extension",
  "version": "1.2.0",
  
  "browserRequests": {
    "browser-list-tabs": {
      "description": "List all open browser tabs",
      "request": {},
      "response": { "tabs": "Tab[]" }
    },
    "browser-navigate": {
      "description": "Navigate to URL in new or existing tab",
      "request": { "url": "string", "tabId?": "number", "newTab?": "boolean", "active?": "boolean" },
      "response": { "tab": "Tab" }
    },
    "browser-screenshot": {
      "description": "Capture screenshot of tab",
      "request": { "tabId?": "number", "fullPage?": "boolean" },
      "response": { "screenshot": "string (base64)" }
    },
    "browser-get-element-info": {
      "description": "Get information about a DOM element",
      "request": { "tabId?": "number", "selector": "string", "includeStyles?": "boolean", "styleProperties?": "string[]" },
      "response": { "element": "ElementInfo" }
    },
    "browser-click-element": {
      "description": "Click a DOM element",
      "request": { "tabId?": "number", "selector": "string", "mode?": "\"human\"|\"native\"" },
      "response": {}
    },
    "browser-fill-input": {
      "description": "Fill an input element with a value",
      "request": { "tabId?": "number", "selector": "string", "value": "string" },
      "response": {}
    },
    "browser-hover-element": {
      "description": "Hover a DOM element with deterministic mouse events",
      "request": { "tabId?": "number", "selector": "string" },
      "response": {}
    },
    "browser-type-input": {
      "description": "Type text into an element with deterministic key/input events",
      "request": { "tabId?": "number", "selector": "string", "text": "string", "clear?": "boolean", "delayMs?": "number" },
      "response": {}
    },
    "browser-press-key": {
      "description": "Press a keyboard key with optional modifiers",
      "request": { "tabId?": "number", "key": "string", "modifiers?": "string[]" },
      "response": {}
    },
    "browser-scroll": {
      "description": "Scroll window or element deterministically",
      "request": { "tabId?": "number", "selector?": "string", "deltaX?": "number", "deltaY?": "number", "to?": "\"top\"|\"bottom\"", "behavior?": "\"auto\"|\"smooth\"" },
      "response": {}
    },
    "browser-wait": {
      "description": "Poll for DOM or URL condition with timeout",
      "request": { "tabId?": "number", "condition": "\"element\"|\"url\"", "selector?": "string", "state?": "\"present\"|\"visible\"|\"hidden\"", "urlIncludes?": "string", "timeoutMs?": "number", "pollMs?": "number" },
      "response": { "matched": "boolean", "elapsedMs": "number" }
    },
    "browser-assert": {
      "description": "Assert DOM and URL conditions",
      "request": { "tabId?": "number", "selector?": "string", "visible?": "boolean", "enabled?": "boolean", "textContains?": "string", "valueEquals?": "string", "urlIncludes?": "string" },
      "response": { "passed": "boolean", "details": "object" }
    },
    "browser-list-interactables": {
      "description": "List actionable interactable elements from a tab DOM",
      "request": { "tabId?": "number", "rootSelector?": "string", "maxNodes?": "number", "includeHidden?": "boolean" },
      "response": { "items": "InteractableNode[]" }
    },
    "browser-enable-network-capture": {
      "description": "Enable network request capture",
      "request": { "tabId?": "number", "urlFilter?": "string[]" },
      "response": {}
    },
    "browser-disable-network-capture": {
      "description": "Disable network request capture",
      "request": {},
      "response": {}
    },
    "browser-get-network-requests": {
      "description": "Get captured network requests",
      "request": { "tabId?": "number", "urlPattern?": "string", "resourceType?": "string", "limit?": "number", "offset?": "number" },
      "response": { "requests": "NetworkRequest[]" }
    },
    "browser-enable-debugger-capture": {
      "description": "Enable debugger-based network capture with response bodies",
      "request": { "tabId": "number", "urlFilter?": "string[]", "maxRequests?": "number", "captureBody?": "boolean" },
      "response": {}
    },
    "browser-disable-debugger-capture": {
      "description": "Disable debugger-based network capture",
      "request": { "tabId": "number" },
      "response": {}
    },
    "browser-get-debugger-requests": {
      "description": "Get debugger-captured requests with response bodies",
      "request": { "tabId": "number", "urlPattern?": "string", "resourceType?": "string", "limit?": "number", "offset?": "number", "sinceTs?": "number", "untilTs?": "number", "markerId?": "string", "includeMarkers?": "boolean", "includeInitiator?": "boolean", "includeFrame?": "boolean" },
      "response": { "requests": "DebuggerRequest[]", "markers?": "DebuggerMarker[]" }
    },
    "browser-clear-debugger-requests": {
      "description": "Clear debugger-captured requests",
      "request": { "tabId": "number" },
      "response": {}
    },
    "browser-debugger-mark": {
      "description": "Create a marker in debugger session for action/phase correlation",
      "request": { "tabId": "number", "markerType": "\"phase\"|\"action-start\"|\"action-end\"", "label": "string", "meta?": "object" },
      "response": { "marker": "DebuggerMarker" }
    }
  },
  
  "extensionMessages": {
    "identify": {
      "description": "Extension identifies itself to backend",
      "payload": { "clientType": "extension" }
    },
    "ping": {
      "description": "Keepalive ping",
      "payload": { "ts": "number" }
    },
    "pong": {
      "description": "Keepalive pong response",
      "payload": { "ts": "number" }
    },
    "element-selected": {
      "description": "User selected an element with picker",
      "payload": { "element": "ElementInfo" }
    },
    "auth": {
      "description": "First-message authentication",
      "payload": { "token": "string" }
    },
    "auth-success": {
      "description": "Authentication successful",
      "payload": {}
    }
  }
}
